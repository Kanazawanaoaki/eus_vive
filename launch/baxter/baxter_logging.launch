<launch>
  <arg name="twitter" default="true" />
  <arg name="debug" default="false" />
  <arg name="camera_ns" default="realsense" />
  <arg name="spherical_stereo" default="true" />
  <arg name="spherical_camera_ns" default="kodak_head" />
  <arg name="spherical_left_camera_ns" default="elp_head_left" />
  <arg name="spherical_right_camera_ns" default="elp_head_right" />
  <arg name="twitter_image_topics" default="/$(arg camera_ns)/color/image_rect_color" />
  <arg name="home_dir" default="$(env HOME)" />

  <include file="$(find jsk_robot_startup)/lifelog/mongodb.launch">
    <arg name="use_daemon" value="false"/>
    <arg name="port" value="27017" />
    <arg name="repl_set_mode" value="false" />
  </include>
  <include file="$(find eus_vive)/launch/include/db_client.launch">
    <arg name="twitter" value="$(arg twitter)" />
    <arg name="debug" value="$(arg debug)" />
    <arg name="camera_ns" value="$(arg camera_ns)" />
    <arg name="twitter_image_topics" value="$(arg twitter_image_topics)" />
  </include>

  <group if="$(arg spherical_stereo)">
    <group ns="lifelog">
      <node name="spherical_left_camera_throttle"
            pkg="nodelet" type="nodelet"
            args="standalone jsk_topic_tools/SynchronizedThrottle" >
        <remap from="/$(arg spherical_left_camera_ns)/camera_info/throttled"
               to="spherical_left_rgb/camera_info"/>
        <remap from="/$(arg spherical_left_camera_ns)/image_raw/compressed/throttled"
               to="spherical_left_rgb/image_raw/compressed"/>
        <rosparam subst_value="true">
          approximate_sync: true
          update_rate: 1.0
          topics:
          - /$(arg spherical_left_camera_ns)/camera_info
          - /$(arg spherical_left_camera_ns)/image_raw/compressed
        </rosparam>
      </node>
      <node name="spherical_left_rgb_image_logger"
            pkg="nodelet" type="nodelet"
            args="load jsk_robot_lifelog/LightweightLogger /mongodb_record_nodelet_manager" >
        <remap from="~input" to="spherical_left_rgb/image_raw/compressed" />
        <rosparam subst_value="true">
          enable_monitor: false
          monitor_topic: /$(arg spherical_left_camera_ns)/image_raw/compressed
          vital_check: true
        </rosparam>
      </node>
      <node name="spherical_left_rgb_camera_info_logger"
            pkg="nodelet" type="nodelet"
            args="load jsk_robot_lifelog/LightweightLogger /mongodb_record_nodelet_manager" >
        <remap from="~input" to="spherical_left_rgb/camera_info" />
        <rosparam subst_value="true">
          enable_monitor: false
          monitor_topic: /$(arg spherical_left_camera_ns)/image_raw/compressed
          vital_check: true
        </rosparam>
      </node>
      <node name="spherical_right_camera_throttle"
            pkg="nodelet" type="nodelet"
            args="standalone jsk_topic_tools/SynchronizedThrottle" >
        <remap from="/$(arg spherical_right_camera_ns)/camera_info/throttled"
               to="spherical_right_rgb/camera_info"/>
        <remap from="/$(arg spherical_right_camera_ns)/image_raw/compressed/throttled"
               to="spherical_right_rgb/image_raw/compressed"/>
        <rosparam subst_value="true">
          approximate_sync: true
          update_rate: 1.0
          topics:
          - /$(arg spherical_right_camera_ns)/camera_info
          - /$(arg spherical_right_camera_ns)/image_raw/compressed
        </rosparam>
      </node>
      <node name="spherical_right_rgb_image_logger"
            pkg="nodelet" type="nodelet"
            args="load jsk_robot_lifelog/LightweightLogger /mongodb_record_nodelet_manager" >
        <remap from="~input" to="spherical_right_rgb/image_raw/compressed" />
        <rosparam subst_value="true">
          enable_monitor: false
          monitor_topic: /$(arg spherical_right_camera_ns)/image_raw/compressed
          vital_check: true
        </rosparam>
      </node>
      <node name="spherical_right_rgb_camera_info_logger"
            pkg="nodelet" type="nodelet"
            args="load jsk_robot_lifelog/LightweightLogger /mongodb_record_nodelet_manager" >
        <remap from="~input" to="spherical_right_rgb/camera_info" />
        <rosparam subst_value="true">
          enable_monitor: false
          monitor_topic: /$(arg spherical_right_camera_ns)/image_raw/compressed
          vital_check: true
        </rosparam>
      </node>
    </group>

    <node name="baxter_vr_rosbag_record" pkg="rosbag" type="record"
          args="/eus_vive/status /tf /robot/joint_states
                /lifelog/rgb/image_rect_color/compressed
                /lifelog/rgb/camera_info
                /lifelog/spherical_left_rgb/image_raw/compressed
                /lifelog/spherical_left_rgb/camera_info
                /lifelog/spherical_right_rgb/image_raw/compressed
                /lifelog/spherical_right_rgb/camera_info
                /lifelog/depth/image_rect_raw/compressedDepth
                /lifelog/depth/camera_info
                --output-prefix $(arg home_dir)/.ros/eus_vive/rosbag/baxter_vr"
          output="screen" />
  </group>
  <group unless="$(arg spherical_stereo)">
    <group ns="lifelog">
      <node name="spherical_camera_throttle"
            pkg="nodelet" type="nodelet"
            args="standalone jsk_topic_tools/SynchronizedThrottle" >
        <remap from="/$(arg spherical_camera_ns)/camera_info/throttled"
               to="spherical_rgb/camera_info"/>
        <remap from="/$(arg spherical_camera_ns)/image_raw/compressed/throttled"
               to="spherical_rgb/image_raw/compressed"/>
        <rosparam subst_value="true">
          approximate_sync: true
          update_rate: 1.0
          topics:
          - /$(arg spherical_camera_ns)/camera_info
          - /$(arg spherical_camera_ns)/image_raw/compressed
        </rosparam>
      </node>
      <node name="spherical_rgb_image_logger"
            pkg="nodelet" type="nodelet"
            args="load jsk_robot_lifelog/LightweightLogger /mongodb_record_nodelet_manager" >
        <remap from="~input" to="spherical_rgb/image_raw/compressed" />
        <rosparam subst_value="true">
          enable_monitor: false
          monitor_topic: /$(arg spherical_camera_ns)/image_raw/compressed
          vital_check: true
        </rosparam>
      </node>
      <node name="spherical_rgb_camera_info_logger"
            pkg="nodelet" type="nodelet"
            args="load jsk_robot_lifelog/LightweightLogger /mongodb_record_nodelet_manager" >
        <remap from="~input" to="spherical_rgb/camera_info" />
        <rosparam subst_value="true">
          enable_monitor: false
          monitor_topic: /$(arg spherical_camera_ns)/image_raw/compressed
          vital_check: true
        </rosparam>
      </node>
    </group>

    <node name="baxter_vr_rosbag_record" pkg="rosbag" type="record"
          args="/eus_vive/status /tf /robot/joint_states
                /lifelog/rgb/image_rect_color/compressed
                /lifelog/rgb/camera_info
                /lifelog/spherical_rgb/image_raw/compressed
                /lifelog/spherical_rgb/camera_info
                /lifelog/depth/image_rect_raw/compressedDepth
                /lifelog/depth/camera_info
                --output-prefix $(arg home_dir)/.ros/eus_vive/rosbag/baxter_vr"
          output="screen" />
  </group>
</launch>
